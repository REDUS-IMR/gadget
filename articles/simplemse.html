<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>GadgetR: Quick and Dirty Management Strategy Evaluation (MSE) using Gadget as the Operating Model (OM) • gadgetr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="GadgetR: Quick and Dirty Management Strategy Evaluation (MSE) using Gadget as the Operating Model (OM)">
<meta property="og:description" content="gadgetr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">gadgetr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.9.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/quickstart.html">GadgetR: Quick Start Guide</a>
    </li>
    <li>
      <a href="../articles/simplemse.html">GadgetR: Quick and Dirty Management Strategy Evaluation (MSE) using Gadget as the Operating Model (OM)</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="simplemse_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>GadgetR: Quick and Dirty Management Strategy Evaluation (MSE) using Gadget as the Operating Model (OM)</h1>
                        <h4 class="author">Ibrahim Umar</h4>
            
            <h4 class="date">2020-07-28</h4>
      
      
      <div class="hidden name"><code>simplemse.Rmd</code></div>

    </div>

    
    
<p>This guide will demonstrate the gadgetr ability to run and manipulate a gadget model simulation so that it would perform as an Operating Model (OM) in a Management Strategy Evaluation (MSE) loop.</p>
<div id="loading-the-package" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-the-package" class="anchor"></a>Loading the package</h1>
<p>Load the package as usual using the command below.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">gadgetr</span>)</pre></body></html></div>
</div>
<div id="loading-the-example-model" class="section level1">
<h1 class="hasAnchor">
<a href="#loading-the-example-model" class="anchor"></a>Loading the example model</h1>
<p>For this guide we will use the included haddock model. This model contains the observed stock and fleet data up to year 1999. However, the model end time (i.e., <code>lastyear</code> parameter) has been set as 2020 to support an exploratory forecast run.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="co"># Get the path of the example haddock data</span>
<span class="no">exPath</span> <span class="kw">&lt;-</span> <span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/loadExample.html">loadExample</a></span>()
<span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="no">exPath</span>)
<span class="co">#&gt; [1] "/Users/runner/work/_temp/Library/gadgetr/extdata/haddock"</span>

<span class="co"># Init the haddock model</span>
<span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/initGadget.html">initGadget</a></span>(<span class="no">exPath</span>, <span class="st">"refinputfile"</span>)
<span class="co">#&gt; Gadget version 2.2.00-BETA running on Mac-1595935325718 Tue Jul 28 11:39:42 2020</span>
<span class="co">#&gt; Starting Gadget from directory: /Users/runner/work/_temp/Library/gadgetr/extdata/haddock</span>
<span class="co">#&gt; using data from directory: /Users/runner/work/_temp/Library/gadgetr/extdata/haddock</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Finished reading model data files, starting to run simulation</span>
<span class="co">#&gt; [1] "Gadget is started with the given model in /Users/runner/work/_temp/Library/gadgetr/extdata/haddock."</span>
<span class="co">#&gt; NULL</span>

<span class="co"># Print info</span>
<span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/getEcosystemInfo.html">getEcosystemInfo</a></span>()
<span class="co">#&gt; $fleet</span>
<span class="co">#&gt; [1] "comm"   "survey" "future"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $stock</span>
<span class="co">#&gt; [1] "had"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $time</span>
<span class="co">#&gt; currentTime currentYear currentStep  totalSteps    finished </span>
<span class="co">#&gt;           1        1978           1         172           0</span>

<span class="co"># Init seed</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span>(<span class="fl">1098765</span>)</pre></body></html></div>
</div>
<div id="defining-helper-functions" class="section level1">
<h1 class="hasAnchor">
<a href="#defining-helper-functions" class="anchor"></a>Defining helper functions</h1>
<p>For the MSE purpose, we need to define four helper functions, namely a SSB calculation function, a recruitment calculation function, a recruitment forecast function, and a TAC calculation function.</p>
<div id="calculating-ssb" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-ssb" class="anchor"></a>Calculating SSB</h2>
<p>This function calculates the spawning stock biomass (SSB) for a given stock. Here we assume that individuals with age more than 3 are mature and only stock information in step 4 will be taken into the calculation.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="co"># Calculate SSB</span>
<span class="no">calcSSB</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">stk</span>) {
    <span class="co"># Get SSB</span>
    <span class="no">subs</span> <span class="kw">&lt;-</span> <span class="no">stk</span>[<span class="no">stk</span>[, <span class="st">"age"</span>] <span class="kw">&gt;=</span> <span class="fl">3</span> <span class="kw">&amp;</span> <span class="no">stk</span>[, <span class="st">"step"</span>] <span class="kw">==</span> <span class="fl">4</span>, ]
    <span class="no">ssb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">subs</span>[, <span class="st">"number"</span>] * <span class="no">subs</span>[, <span class="st">"meanWeights"</span>])
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">ssb</span>)
}</pre></body></html></div>
</div>
<div id="calculating-recruitment" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-recruitment" class="anchor"></a>Calculating recruitment</h2>
<p>A simple function for calculating the “real” recruitment values for a given stock in a year. Only age 1 individuals are used in the calculation and as stock information (numbers and weights) were collected after each step is run, we use only the values from step 2.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="co"># Calculate Recruitment</span>
<span class="no">calcRecruitment</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">stk</span>) {
    <span class="co"># Get Recruitment (based on fbar and only from the last step)</span>
    <span class="no">subs</span> <span class="kw">&lt;-</span> <span class="no">stk</span>[<span class="no">stk</span>[, <span class="st">"age"</span>] <span class="kw">==</span> <span class="fl">1</span> <span class="kw">&amp;</span> <span class="no">stk</span>[, <span class="st">"step"</span>] <span class="kw">==</span> <span class="fl">2</span>, ]
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">subs</span>[, <span class="st">"number"</span>]))
}</pre></body></html></div>
</div>
<div id="forecasting-a-recruitment" class="section level2">
<h2 class="hasAnchor">
<a href="#forecasting-a-recruitment" class="anchor"></a>Forecasting a recruitment</h2>
<p>This function use a bit of “magic” to forcasting the stok recruitment value.</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="co"># Supposed the haddock recruitment forecast for a given year is a matter of</span>
<span class="co"># picking a random number...</span>
<span class="no">fcRecruitment</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fl">25</span>, <span class="fl">1</span>) * <span class="fl">1000</span>)
}</pre></body></html></div>
</div>
<div id="calculating-tac" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-tac" class="anchor"></a>Calculating TAC</h2>
<p>A simple function for calculating the next year’s total allowable catch (TAC) given a stock’s SSB value for a particular year.</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="co"># ... and calculating TAC is a matter of taking 35% of the stock's last year</span>
<span class="co"># SSB value</span>
<span class="no">calcTAC</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">ssb</span>) {
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fl">.4</span> * <span class="no">ssb</span>)
}</pre></body></html></div>
</div>
</div>
<div id="running-the-hindcast-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#running-the-hindcast-simulation" class="anchor"></a>Running the hindcast simulation</h1>
<p>The haddock example model hindcast period spans from year 1978 until 1999. Therefore, as a first step, we need to run gadget until the end of year 1999.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># Placeholders for values</span>
<span class="no">stats</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">ssb</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">fcrec</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="no">rec</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()

<span class="co"># Loop for the hindcast period</span>
<span class="no">forecastYear</span> <span class="kw">&lt;-</span> <span class="fl">2000</span>
<span class="no">status</span> <span class="kw">&lt;-</span> <span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/getEcosystemInfo.html">getEcosystemInfo</a></span>()
<span class="kw">while</span> ( <span class="no">status</span><span class="kw">[[</span><span class="st">"time"</span>]][<span class="st">"currentYear"</span>] <span class="kw">&lt;</span> <span class="no">forecastYear</span> ) {
  <span class="co"># Append stats</span>
  <span class="no">curYr</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">status</span><span class="kw">[[</span><span class="st">"time"</span>]][<span class="st">"currentYear"</span>])
  <span class="no">stats</span><span class="kw">[[</span><span class="no">curYr</span>]] <span class="kw">&lt;-</span> <span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/runYear.html">runYear</a></span>()
  <span class="no">ssb</span><span class="kw">[[</span><span class="no">curYr</span>]] <span class="kw">&lt;-</span> <span class="fu">calcSSB</span>(<span class="no">stats</span><span class="kw">[[</span><span class="no">curYr</span>]]$<span class="no">stock</span>$<span class="no">had</span>$<span class="no">stk</span>)
  <span class="co"># Get the latest runtime information</span>
  <span class="no">status</span> <span class="kw">&lt;-</span> <span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/getEcosystemInfo.html">getEcosystemInfo</a></span>()
}</pre></body></html></div>
</div>
<div id="running-the-forecast-simulation" class="section level1">
<h1 class="hasAnchor">
<a href="#running-the-forecast-simulation" class="anchor"></a>Running the forecast simulation</h1>
<p>Now, we run the simulation from year 2000 until 2020. In addition to looping through the years, we also performing these additional steps at the beginning of the year (i.e., before step 1):</p>
<ol style="list-style-type: decimal">
<li>Defining the Haddock recruitment value by calling the <code>fcRecruitment()</code> function.</li>
<li>Applying the obtained recruitment value into gadget simulation using <code><a href="../reference/updateRenewal.html">gadgetr::updateRenewal()</a></code> function, targeting the “had” stock.</li>
<li>Calculating last year’s SSB value in the beginning of the year using <code>calcSSB()</code> function.</li>
<li>Calculating TAC value for the year using <code>calcTAC()</code> function.</li>
<li>Applying the calculated TAC value back into gadget simulation using <code><a href="../reference/updateAmount.html">gadgetr::updateAmount()</a></code> function, targeting the “future” fleet.</li>
</ol>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># MSE loop</span>
<span class="kw">while</span> ( <span class="no">status</span><span class="kw">[[</span><span class="st">"time"</span>]][<span class="st">"finished"</span>] <span class="kw">!=</span> <span class="fl">1</span> ) {
  <span class="co"># Time calculation</span>
  <span class="no">curYr</span> <span class="kw">&lt;-</span> <span class="no">status</span><span class="kw">[[</span><span class="st">"time"</span>]][<span class="st">"currentYear"</span>]
  <span class="no">lastYr</span> <span class="kw">&lt;-</span> <span class="no">curYr</span> - <span class="fl">1</span>

  <span class="co"># Calculate Recruitment for this year</span>
  <span class="no">recNumber</span> <span class="kw">&lt;-</span> <span class="fu">fcRecruitment</span>()
  <span class="no">fcrec</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">curYr</span>)]] <span class="kw">&lt;-</span> <span class="no">recNumber</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"Recruitment in"</span>, <span class="no">curYr</span>, <span class="st">"is"</span>, <span class="no">recNumber</span>))

  <span class="co"># Apply recruitment number for this year haddock stock</span>
  <span class="co"># note that this is similar to the format found in "had.rec" file</span>
  <span class="fu"><a href="../reference/updateRenewal.html">updateRenewal</a></span>(<span class="st">"had"</span>, <span class="no">curYr</span>, <span class="kw">step</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">area</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">age</span> <span class="kw">=</span> <span class="fl">1</span>,
      <span class="kw">number</span> <span class="kw">=</span> <span class="no">recNumber</span>, <span class="kw">mean</span> <span class="kw">=</span> <span class="fl">16.41</span>, <span class="kw">sdev</span> <span class="kw">=</span> <span class="fl">2.25</span> , <span class="kw">alpha</span> <span class="kw">=</span> <span class="fl">8.85e-6</span>,
      <span class="kw">beta</span> <span class="kw">=</span> <span class="fl">3.0257</span>)

  <span class="co"># Calculate last year SSB</span>
  <span class="no">ssb</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">lastYr</span>)]] <span class="kw">&lt;-</span>
      <span class="fu">calcSSB</span>(<span class="no">stats</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">lastYr</span>)]]$<span class="no">stock</span>$<span class="no">had</span>$<span class="no">stk</span>)

  <span class="co"># Calculate TAC for this year</span>
  <span class="no">tac</span> <span class="kw">&lt;-</span> <span class="fu">calcTAC</span>(<span class="no">ssb</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">lastYr</span>)]])
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"TAC in"</span>, <span class="no">curYr</span>, <span class="st">"is"</span>, <span class="no">tac</span>))

  <span class="co"># Apply TAC to fleet data (spread out between 4 steps in a year)</span>
  <span class="no">tacPortion</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.232</span>, <span class="fl">0.351</span>, <span class="fl">0.298</span>, <span class="fl">0.119</span>)
  <span class="no">targetFleet</span> <span class="kw">&lt;-</span> <span class="st">"future"</span>
  <span class="fu"><a href="../reference/updateAmount.html">updateAmount</a></span>(<span class="no">targetFleet</span>, <span class="no">curYr</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="no">tacPortion</span><span class="kw">[[</span><span class="fl">1</span>]] * <span class="no">tac</span>)
  <span class="fu"><a href="../reference/updateAmount.html">updateAmount</a></span>(<span class="no">targetFleet</span>, <span class="no">curYr</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="no">tacPortion</span><span class="kw">[[</span><span class="fl">2</span>]] * <span class="no">tac</span>)
  <span class="fu"><a href="../reference/updateAmount.html">updateAmount</a></span>(<span class="no">targetFleet</span>, <span class="no">curYr</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="no">tacPortion</span><span class="kw">[[</span><span class="fl">3</span>]] * <span class="no">tac</span>)
  <span class="fu"><a href="../reference/updateAmount.html">updateAmount</a></span>(<span class="no">targetFleet</span>, <span class="no">curYr</span>, <span class="fl">4</span>, <span class="fl">1</span>, <span class="no">tacPortion</span><span class="kw">[[</span><span class="fl">4</span>]] * <span class="no">tac</span>)

  <span class="co"># Forward the time</span>
  <span class="no">stats</span><span class="kw">[[</span><span class="fu"><a href="https://rdrr.io/r/base/character.html">as.character</a></span>(<span class="no">curYr</span>)]] <span class="kw">&lt;-</span> <span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/runYear.html">runYear</a></span>()

  <span class="co"># Get the latest runtime information</span>
  <span class="no">status</span> <span class="kw">&lt;-</span> <span class="kw pkg">gadgetr</span><span class="kw ns">::</span><span class="fu"><a href="../reference/getEcosystemInfo.html">getEcosystemInfo</a></span>()
}
<span class="co">#&gt; [1] "Recruitment in 2000 is 10000"</span>
<span class="co">#&gt; [1] "TAC in 2000 is 49692321.0158688"</span>
<span class="co">#&gt; Step is 89</span>
<span class="co">#&gt; Change fleet "future" - Step: 89 - Area: 1 with 1.15286e+07</span>
<span class="co">#&gt; Value before 0</span>
<span class="co">#&gt; Value after 1.15286e+07</span>
<span class="co">#&gt; Step is 90</span>
<span class="co">#&gt; Change fleet "future" - Step: 90 - Area: 1 with 1.7442e+07</span>
<span class="co">#&gt; Value before 0</span>
<span class="co">#&gt; Value after 1.7442e+07</span>
<span class="co">#&gt; Step is 91</span>
<span class="co">#&gt; Change fleet "future" - Step: 91 - Area: 1 with 1.48083e+07</span>
<span class="co">#&gt; Value before 0</span>
<span class="co">#&gt; Value after 1.48083e+07</span>
<span class="co">#&gt; Step is 92</span>
<span class="co">#&gt; Change fleet "future" - Step: 92 - Area: 1 with 5.91339e+06</span>
<span class="co">#&gt; Value before 0</span>
<span class="co">#&gt; Value after 5.91339e+06</span>
<span class="co">#&gt; [1] "Recruitment in 2001 is 1000"</span>
<span class="co">#&gt; [1] "TAC in 2001 is 49898385.0089445"</span>
<span class="co">#&gt; Step is 93</span>
<span class="co">#&gt; Change fleet "future" - Step: 93 - Area: 1 with 1.15764e+07</span>
<span class="co">#&gt; Value before 0</span>
<span class="co">#&gt; Value after 1.15764e+07</span>
<span class="co">#&gt; Step is 94</span>
<span class="no">...</span></pre></body></html></div>
</div>
<div id="summarizing-recruitment-and-catch-values" class="section level1">
<h1 class="hasAnchor">
<a href="#summarizing-recruitment-and-catch-values" class="anchor"></a>Summarizing recruitment and catch values</h1>
<p>After the loop finishes, we might want to summarize several important metric values over the years.</p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="co"># Calculate real recruitment</span>
<span class="no">rec</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">stats</span>, <span class="kw">function</span>(<span class="no">x</span>) <span class="fu">calcRecruitment</span>(<span class="no">x</span>$<span class="no">stock</span>$<span class="no">had</span>$<span class="no">stk</span>))

<span class="co"># Calculate real catch (future fleet)</span>
<span class="no">catch</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">stats</span>, <span class="kw">function</span>(<span class="no">x</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span>(<span class="no">x</span>$<span class="no">fleet</span>$<span class="no">future</span>$<span class="no">catch</span>$<span class="no">had</span>[, <span class="st">"biomassConsumed"</span>]))</pre></body></html></div>
</div>
<div id="plotting-the-results" class="section level1">
<h1 class="hasAnchor">
<a href="#plotting-the-results" class="anchor"></a>Plotting the results</h1>
<p>And plot it:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># Plot the world</span>
<span class="no">maxy</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">ssb</span>), <span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">rec</span>)))
<span class="no">cl</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html">rainbow</a></span>(<span class="fl">3</span>)
<span class="fu"><a href="https://rdrr.io/r/base/plot.html">plot</a></span>(<span class="fl">0</span>, <span class="fl">0</span>, <span class="kw">xlim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">1978</span>, <span class="fl">2020</span>), <span class="kw">ylim</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0</span>, <span class="no">maxy</span>), <span class="kw">type</span> <span class="kw">=</span> <span class="st">"n"</span>, <span class="kw">xlab</span> <span class="kw">=</span> <span class="st">"Year"</span>,
    <span class="kw">ylab</span> <span class="kw">=</span> <span class="st">""</span>, <span class="kw">main</span> <span class="kw">=</span> <span class="st">"Haddock gadget model"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">ssb</span>), <span class="no">ssb</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">cl</span>[<span class="fl">1</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">rec</span>), <span class="no">rec</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">cl</span>[<span class="fl">2</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/lines.html">lines</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">catch</span>), <span class="no">catch</span>, <span class="kw">col</span> <span class="kw">=</span> <span class="no">cl</span>[<span class="fl">3</span>], <span class="kw">type</span> <span class="kw">=</span> <span class="st">"l"</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span>(<span class="kw">v</span> <span class="kw">=</span> <span class="fl">2000</span>, <span class="kw">col</span><span class="kw">=</span><span class="st">"darkorange"</span>, <span class="kw">lwd</span><span class="kw">=</span><span class="fl">3</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">2</span>)
<span class="fu"><a href="https://rdrr.io/r/graphics/legend.html">legend</a></span>(<span class="fl">1980</span>, <span class="no">maxy</span>, <span class="kw">legend</span><span class="kw">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"SSB (had)"</span>, <span class="st">"Recruitment (had)"</span>,
    <span class="st">"Catch (future fleet)"</span>), <span class="kw">col</span><span class="kw">=</span><span class="no">cl</span>, <span class="kw">lty</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">cex</span><span class="kw">=</span><span class="fl">1</span>, <span class="kw">bg</span><span class="kw">=</span><span class="st">'lightblue1'</span>)</pre></body></html></div>
<div class="figure">
<img src="simplemse_files/figure-html/plot-1.png" alt="Haddock simulation numbers" width="672"><p class="caption">
Haddock simulation numbers
</p>
</div>
</div>
<div id="ending-gadget" class="section level1">
<h1 class="hasAnchor">
<a href="#ending-gadget" class="anchor"></a>Ending gadget</h1>
<p>After each simulation, it is necessary to properly terminate an active gadget simulation run.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu"><a href="../reference/endGadget.html">endGadget</a></span>()
<span class="co">#&gt; [1] "Gadget succesfully terminates."</span>
<span class="co">#&gt; NULL</span></pre></body></html></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Bjarki Thor Elvarsson, James Begley, Hoskuldur Bjornsson, Narfi Stefansson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
